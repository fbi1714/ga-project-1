!function(t){function e(e){t.extend(this,e),"undefined"==typeof this.selector&&(this.selector="#"+this.umlaut_section_id),"undefined"==typeof this.position&&(this.position="html"),"undefined"==typeof this.container&&(this.container=t(document))}function n(n,i,s){if("object"==typeof n?t.extend(this,n):(this.umlaut_base=n,this.context_object=i,this.locale=s),"undefined"==typeof this.umlaut_base)throw new Error("new Umlaut.HtmlUpdater: missing umlaut_base (String) argument");if("undefined"==typeof this.context_object)throw new Error("new Umlaut.HtmlUpdater: missing context_object (String) argument");this.umlaut_base=this.umlaut_base.replace(/\?.*$/,""),this.umlaut_base=this.umlaut_base.replace(/\/$/,""),this.umlaut_uri=this.umlaut_base+"/resolve/partial_html_sections?umlaut.response_format=json&"+this.context_object,this.locale&&(this.umlaut_uri+="&umlaut.locale="+this.locale),this.section_targets=[],this.add_section_target=function(n){var o=new e(n);"undefined"!=typeof this.container&&(o.container=t(this.container)),this.section_targets.push(o)},this.complete=o,this.before_update=o,this.after_update=o,this.is_remote_url=function(t){var e=/^(\w+:)?\/\/([^\/?#]+)/,n=e.exec(t);return n&&(n[1]&&n[1]!==location.protocol||n[2]!==location.host)},this.update=function(){var e=this,n=this.is_remote_url(this.umlaut_uri)?"jsonp":"json";t.ajax({url:e.umlaut_uri,dataType:n,jsonp:"umlaut.jsonp",error:function(){t.error("Problem loading background elements.")},success:function(n){for(var o=0;o<e.section_targets.length;o++){var i=e.section_targets[o],s=e.find_umlaut_response_section(n,i.umlaut_section_id);if("undefined"!=typeof s){var a=null;"undefined"!=typeof s.response_count&&(a=parseInt(s.response_count.value));var u=i.ensure_placement_destination(),r=t('<div class="umlaut" style="display:none" class="'+i.umlaut_section_id+'"></div>');r.html(s.html_content);var l=i.before_update(r,a,i);0!=l&&(l=e.before_update(r,a,i)),0!=l&&(u.replaceWith(r),i.host_div_element=r,r.show(),i.after_update(r,a,i),e.after_update(r,a,i))}}if(n.partial_html_sections.in_progress){e.umlaut_uri=n.partial_html_sections.in_progress.refresh_url.replace(/[?;&]umlaut\.jsonp=[^;&]+/,"");var c=n.partial_html_sections.in_progress.requested_wait_seconds;window.setTimeout(function(){e.update()},1e3*c)}else{e.complete();for(var o=0;o<e.section_targets.length;o++){var i=e.section_targets[o];i.complete(i)}}}})},this.find_umlaut_response_section=function(e,n){return t.grep(e.partial_html_sections.html_section,function(t){return t.id==n})[0]}}var o=function(){};e.prototype.before_update=o,e.prototype.after_update=o,e.prototype.complete=o,e.prototype.ensure_placement_destination=function(){if("undefined"==typeof this.selector)return null;if(this.host_div_element)return this.host_div_element;var e=t('<div class="umlaut" style="display:none"></div>');return this.container.find(this.selector).eq(0)[this.position](e),this.host_div_element=e,this.host_div_element},"undefined"==typeof window.Umlaut&&(window.Umlaut=new Object),window.Umlaut.HtmlUpdater=n,window.Umlaut.Loader=function(){this.load=function(){"undefined"!=typeof console&&"undefined"!=typeof console.log&&console.log("WARN: Umlaut.Loader no longer supported in Umlaut 3.x, you may have not loaded Umlaut JS Behaviors as desired. See Umlaut documentation for new way.")}}}(jQuery);